// Copyright (c) 2024-2025 silverslither.

#include "filters.h"
#include <math.h>
#include <stdint.h>

double Triangle(double x) {
    return 1.0 - x;
}

double Hermite(double x) {
    return 1.0 - x * x * (3.0 - 2.0 * x);
}

double BSpline2(double x) {
    if (x <= 0.5)
        return 0.75 - x * x;
    const double x_ = x - 1.5;
    return 0.5 * x_ * x_;
}

// Normalized to 6.0
double BSpline3(double x) {
    if (x <= 1.0)
        return 4.0 - x * x * (6.0 - 3.0 * x);
    const double x_ = 2.0 - x;
    return x_ * x_ * x_;
}

// Normalized to 9.0
double MitNet(double x) {
    if (x <= 1.0)
        return 8.0 - x * x * (18.0 - 10.5 * x);
    return 16.0 - x * (30.0 - x * (18.0 - 3.5 * x));
}

double CatRom(double x) {
    if (x <= 1.0)
        return 1.0 - x * x * (2.5 - 1.5 * x);
    return 2.0 - x * (4.0 - x * (2.5 - 0.5 * x));
}

static inline double hsin(double x) {
    const double x2 = x * x;
    double v = 1.6338022763241866 - 0.7211254631780478 * x2;
    v = 1.0 - v * x2;
    return x * v;
}

static inline double hcos3w(double x) {
    const double x2 = x * x;
    double v = 0.023077941650754795 - 0.0007869230084260478 * x2;
    v = 0.25311490431737477 - v * x2;
    return 0.46164 - v * x2;
}
double Hamming3(double x) {
    if (x < 7.450580596923828e-9)
        return 1.0;
    const int round_x = (int)(x + 0.5);
    const double dist_x = x - (double)round_x;
    const uint64_t poly_x_ = ((uint64_t)round_x << 63) ^ *(const uint64_t *)&dist_x;
    const double poly_x = *(const double *)&poly_x_;
    const double w = copysign(hcos3w(x > 1.5 ? x - 3.0 : x), 1.5 - x);
    return hsin(poly_x) * (0.53836 + w) / x;
}

static inline double hcos4w(double x) {
    const double x2 = x * x;
    double v = 0.007302004975434134 - 0.00014005538895082734 * x2;
    v = 0.1423771336785233 - v * x2;
    return 0.46164 - v * x2;
}
double Hamming4(double x) {
    if (x < 7.450580596923828e-9)
        return 1.0;
    const int round_x = (int)(x + 0.5);
    const double dist_x = x - (double)round_x;
    const uint64_t poly_x_ = ((uint64_t)round_x << 63) ^ *(const uint64_t *)&dist_x;
    const double poly_x = *(const double *)&poly_x_;
    const double w = copysign(hcos4w(x > 2.0 ? x - 4.0 : x), 2.0 - x);
    return hsin(poly_x) * (0.53836 + w) / x;
}

static inline double hcos8w(double x) {
    const double x2 = x * x;
    double v = 0.0004563753109646334 - 0.0000021883654523566772 * x2;
    v = 0.03559428341963083 - v * x2;
    return 0.46164 - v * x2;
}
double Hamming8(double x) {
    if (x < 7.450580596923828e-9)
        return 1.0;
    const int round_x = (int)(x + 0.5);
    const double dist_x = x - (double)round_x;
    const uint64_t poly_x_ = ((uint64_t)round_x << 63) ^ *(const uint64_t *)&dist_x;
    const double poly_x = *(const double *)&poly_x_;
    const double w = copysign(hcos8w(x > 4.0 ? x - 8.0 : x), 4.0 - x);
    return hsin(poly_x) * (0.53836 + w) / x;
}

// Normalized to 5.25
double OMOMS3(double x) {
    if (x <= 1.0)
        return 3.25 + x * (0.375 - x * (5.25 - 2.625 * x));
    return 7.25 - x * (10.625 - x * (5.25 - 0.875 * x));
}

// Normalized to 7920.0
double OMOMS5(double x) {
    if (x <= 1.0)
        return x * (x * (x * (x * (1980.0 - 660.0 * x) - 400.0) - 3240.0) - 10.0) + 4122.0;
    if (x <= 2.0)
        return x * (x * (x * (x * (330.0 * x - 2970.0) + 10100.0) - 14940.0) + 6755.0) + 2517.0;
    return x * (x * (x * (x * (990.0 - 66.0 * x) - 5980.0) + 18180.0) - 27811.0) + 17121.0;
}

// Normalized to 10810800.0
double OMOMS7(double x) {
    if (x <= 1.0)
        return x * (x * (x * (x * (x * (x * (75075.0 * x - 300300.0) + 105105.0) + 900900.0) + 13475.0) - 3146220.0) + 105.0) + 4948180.0;
    if (x <= 2.0)
        return x * (x * (x * (x * (x * (x * (540540.0 - 45045.0 * x) - 2585583.0) + 5945940.0) - 5893965.0) + 1122660.0) - 1746423.0) + 5258196.0;
    if (x <= 3.0)
        return x * (x * (x * (x * (x * (x * (15015.0 * x - 300300.0) + 2543541.0) - 11711700.0) + 31113775.0) - 46029060.0) + 32016621.0) - 5206580.0;
    return x * (x * (x * (x * (x * (x * (60060.0 - 2145.0 * x) - 723723.0) + 4864860.0) - 19700065.0) + 48052620.0) - 65363763.0) + 38243404.0;
}

// Normalized to 15237331200.0
double OMOMS9(double x) {
    if (x <= 1.0)
        return x * (x * (x * (x * (x * (x * (x * (x * (26453700.0 - 5290740.0 * x) - 13366080.0) - 124378800.0) - 4334148.0) + 831639900.0) - 196560.0) - 3297130200.0) - 630.0) + 6304980070.0;
    if (x <= 2.0)
        return x * (x * (x * (x * (x * (x * (x * (x * (3527160.0 * x - 52907400.0) + 326355120.0) - 1021020000.0) + 1581757632.0) - 1095221400.0) + 1592758440.0) - 4155606000.0) + 272399820.0) + 6266333140.0;
    if (x <= 3.0)
        return x * (x * (x * (x * (x * (x * (x * (x * (37791000.0 - 1511640.0 * x) - 411961680.0) + 2543268000.0) - 9649877328.0) + 22826785800.0) - 32789703960.0) + 27948819600.0) - 17372323980.0) + 10609174660.0;
    if (x <= 4.0)
        return x * (x * (x * (x * (x * (x * (x * (x * (377910.0 * x - 13226850.0) + 205026120.0) - 1842477000.0) + 10538628282.0) - 39561726750.0) + 96591317940.0) - 145597479300.0) + 119192193945.0) - 37400739395.0;
    return x * (x * (x * (x * (x * (x * (x * (x * (1889550.0 - 41990.0 * x) - 37897080.0) + 444607800.0) - 3362438898.0) + 16998522450.0) - 57440976060.0) + 125101395900.0) - 159331204505.0) + 90406907525.0;
}

double L_bspline2i[11] = {
    0.14583333333333334,
    0.17142857142857143,
    0.1715686274509804,
    0.17157275021026072,
    0.17157287157287157,
    0.1715728751454532,
    0.17157287525062018,
    0.171572875253716,
    0.17157287525380713,
    0.17157287525380982,
    0.1715728752538099
};

double L_bspline3i[14] = {
    0.20833333333333334,
    0.26666666666666666,
    0.26785714285714285,
    0.2679425837320574,
    0.26794871794871794,
    0.2679491583648231,
    0.26794918998527245,
    0.26794919225551855,
    0.2679491924185149,
    0.26794919243021753,
    0.2679491924310577,
    0.26794919243111803,
    0.26794919243112236,
    0.2679491924311227
};

double L_omoms3[18] = {
    0.2490842490842491,
    0.33986928104575165,
    0.34362717574396406,
    0.34407148031876356,
    0.34412408743959544,
    0.34413031736062233,
    0.3441310551448089,
    0.34413114251779625,
    0.34413115286505125,
    0.3441311540904378,
    0.3441311542355558,
    0.34413115425274154,
    0.3441311542547768,
    0.34413115425501783,
    0.34413115425504637,
    0.34413115425504975,
    0.34413115425505014,
    0.3441311542550502
};

double LU_omoms5[2 * 29 + 2 * 2] = {
    0.3350277809294441,
    0.51508506362617,
    0.5412154225956436,
    0.545490691351423,
    0.5464560907040952,
    0.5466745161117378,
    0.5467239596653614,
    0.5467351531794638,
    0.5467376873450833,
    0.5467382610733692,
    0.5467383909640983,
    0.5467384203710622,
    0.5467384270287322,
    0.5467384285360135,
    0.5467384288772587,
    0.5467384289545157,
    0.5467384289720066,
    0.5467384289759665,
    0.546738428976863,
    0.5467384289770659,
    0.5467384289771119,
    0.5467384289771223,
    0.5467384289771247,
    0.5467384289771252,
    0.5467384289771253,
    0.5467384289771253,
    0.5467384289771253,
    0.554226079290776,
    0.7094614425507857,
    0.01973418684663226,
    0.031575276815259845,
    0.03335580480777056,
    0.03365886757023818,
    0.033727333699264936,
    0.03374282549235333,
    0.03374633230566658,
    0.03374712621349029,
    0.03374730595100169,
    0.03374734664309262,
    0.03374735585568596,
    0.03374735794139602,
    0.03374735841359605,
    0.033747358520501064,
    0.03374735854470412,
    0.03374735855018363,
    0.03374735855142418,
    0.03374735855170504,
    0.03374735855176863,
    0.03374735855178303,
    0.03374735855178628,
    0.033747358551787024,
    0.03374735855178719,
    0.033747358551787225,
    0.03374735855178723,
    0.03374735855178724,
    0.03374735855178724,
    0.034209532795360924,
    0.044391144283367365,
    22.02981154743445,
    16.536330631293907,
    1.3153961136023917,
    1.0136951235120952
};

double LU_omoms7[3 * 39 + 3 * 3] = {
    0.3946601030150443,
    0.6552253929710059,
    0.7219452327747214,
    0.7370378592451199,
    0.7417592863955021,
    0.7432809265294223,
    0.7437722513836884,
    0.7439310053597589,
    0.7439823135642764,
    0.7439988974407357,
    0.7440042578505186,
    0.744005990514048,
    0.7440065505706535,
    0.7440067316004637,
    0.744006790115628,
    0.7440068090297772,
    0.7440068151434927,
    0.7440068171196595,
    0.7440068177584259,
    0.7440068179648975,
    0.7440068180316365,
    0.7440068180532088,
    0.7440068180601818,
    0.7440068180624356,
    0.7440068180631642,
    0.7440068180633996,
    0.7440068180634758,
    0.7440068180635004,
    0.7440068180635083,
    0.7440068180635109,
    0.7440068180635118,
    0.744006818063512,
    0.7440068180635121,
    0.7440068180635121,
    0.7440068180635121,
    0.7440068180635121,
    0.744388004654122,
    0.7674051063331826,
    0.9891597127146454,
    0.048552547483553636,
    0.08824335898416574,
    0.09899831780514949,
    0.10161741103269774,
    0.1024445555281448,
    0.10271143989051211,
    0.10279764195568879,
    0.10282549747614399,
    0.10283450040495906,
    0.10283741035734405,
    0.10283835094352761,
    0.10283865497255507,
    0.10283875324523466,
    0.10283878501039019,
    0.10283879527799922,
    0.10283879859684987,
    0.10283879966961862,
    0.10283880001637505,
    0.10283880012845888,
    0.10283880016468828,
    0.1028388001763989,
    0.10283880018018418,
    0.10283880018140772,
    0.1028388001818032,
    0.10283880018193105,
    0.10283880018197236,
    0.10283880018198573,
    0.10283880018199004,
    0.10283880018199144,
    0.10283880018199189,
    0.10283880018199204,
    0.10283880018199208,
    0.1028388001819921,
    0.1028388001819921,
    0.10283880018199211,
    0.10283880018199211,
    0.102891488908321,
    0.10612732581131963,
    0.14102440455025297,
    0.0008154378527323731,
    0.0014959925213110248,
    0.0016826327676131548,
    0.0017285140249353596,
    0.0017430202797333353,
    0.0017477015206130353,
    0.001749213594551122,
    0.0017497022147605157,
    0.0017498601377208415,
    0.0017499111820737036,
    0.0017499276811835094,
    0.0017499330142499597,
    0.001749934738081213,
    0.0017499352952835643,
    0.0017499354753908486,
    0.0017499355336078274,
    0.0017499355524255935,
    0.0017499355585081546,
    0.0017499355604742514,
    0.0017499355611097628,
    0.0017499355613151823,
    0.001749935561381581,
    0.0017499355614030434,
    0.001749935561409981,
    0.0017499355614122233,
    0.001749935561412948,
    0.0017499355614131824,
    0.001749935561413258,
    0.0017499355614132826,
    0.0017499355614132906,
    0.001749935561413293,
    0.0017499355614132939,
    0.001749935561413294,
    0.0017499355614132943,
    0.0017499355614132943,
    0.0017499355614132943,
    0.0017508321284261858,
    0.0018058940900347411,
    0.002400942620312589,
    643.4604548839048,
    451.76134402118873,
    429.2767442618875,
    81.65042086619599,
    60.8727369247295,
    58.86551171127319,
    1.3720177321121036,
    1.0319774795457344,
    1.0005123428728813
};

double LU_omoms9[4 * 49 + 4 * 4] = {
    0.43840710447516446,
    0.764339329211963,
    0.8804270386441334,
    0.9137614552116923,
    0.9261696427894399,
    0.9311061133453341,
    0.9330785408268168,
    0.9338679105496829,
    0.9341840478468019,
    0.9343106997177667,
    0.9343614465627739,
    0.9343817810434871,
    0.934389929371428,
    0.9343931945635031,
    0.9343945029950211,
    0.9343950273122262,
    0.9343952374178004,
    0.9343953216118088,
    0.934395355350238,
    0.9343953688699848,
    0.9343953742876512,
    0.9343953764586319,
    0.9343953773285927,
    0.9343953776772056,
    0.9343953778169026,
    0.9343953778728823,
    0.9343953778953147,
    0.9343953779043038,
    0.9343953779079059,
    0.9343953779093495,
    0.9343953779099279,
    0.9343953779101597,
    0.9343953779102525,
    0.9343953779102897,
    0.9343953779103047,
    0.9343953779103107,
    0.934395377910313,
    0.934395377910314,
    0.9343953779103144,
    0.9343953779103146,
    0.9343953779103146,
    0.9343953779103146,
    0.9343953779103147,
    0.9343953779103147,
    0.9343953779103147,
    0.9344066634602078,
    0.936506600987407,
    0.9803921372398263,
    1.256963720981432,
    0.08015045615003767,
    0.16026142151999578,
    0.1911453381123658,
    0.20085474599297248,
    0.20456817928604804,
    0.20605219147521062,
    0.2066460768617551,
    0.20688388828792859,
    0.20697915042781725,
    0.2070173176216951,
    0.20703261088636304,
    0.2070387390289709,
    0.20704119467620552,
    0.20704217870280908,
    0.20704257302328946,
    0.20704273103618498,
    0.2070427943554738,
    0.20704281972893138,
    0.20704282989664552,
    0.20704283397107706,
    0.20704283560379338,
    0.20704283625805953,
    0.2070428365202387,
    0.20704283662529976,
    0.20704283666740012,
    0.20704283668427068,
    0.20704283669103107,
    0.20704283669374013,
    0.2070428366948257,
    0.20704283669526072,
    0.20704283669543505,
    0.20704283669550488,
    0.2070428366955329,
    0.2070428366955441,
    0.2070428366955486,
    0.2070428366955504,
    0.20704283669555112,
    0.2070428366955514,
    0.2070428366955515,
    0.20704283669555157,
    0.2070428366955516,
    0.2070428366955516,
    0.2070428366955516,
    0.2070428366955516,
    0.2070428366955516,
    0.20704533734176497,
    0.2075131466915692,
    0.217725606361724,
    0.29222771952362475,
    0.0038512513589020504,
    0.007918422609272549,
    0.009533085260394609,
    0.010053017989106216,
    0.010253110421126832,
    0.010333167446487757,
    0.01036521856805841,
    0.010378054843310508,
    0.01038319706547179,
    0.010385257361610008,
    0.01038608291070682,
    0.01038641371624785,
    0.01038654627558892,
    0.010386599394768936,
    0.010386620680762043,
    0.010386629210528428,
    0.01038663262859598,
    0.010386633998292235,
    0.010386634547160278,
    0.010386634767104039,
    0.010386634855240447,
    0.010386634890558688,
    0.0103866349047115,
    0.010386634910382851,
    0.01038663491265549,
    0.010386634913566187,
    0.010386634913931124,
    0.010386634914077361,
    0.010386634914135964,
    0.010386634914159445,
    0.010386634914168856,
    0.010386634914172627,
    0.010386634914174138,
    0.010386634914174743,
    0.010386634914174986,
    0.010386634914175083,
    0.010386634914175122,
    0.010386634914175137,
    0.010386634914175144,
    0.010386634914175146,
    0.010386634914175148,
    0.010386634914175148,
    0.010386634914175148,
    0.010386634914175148,
    0.010386634914175148,
    0.010386760363090369,
    0.010410228767037129,
    0.010922685055330675,
    0.014693194502076021,
    2.0633142678123148e-5,
    4.255806051785078e-5,
    5.129467065265626e-5,
    5.411569850064344e-5,
    5.520211971843914e-5,
    5.5636855358945376e-5,
    5.5810911578808216e-5,
    5.588062122587681e-5,
    5.5908547145092756e-5,
    5.591973604306967e-5,
    5.592421937557208e-5,
    5.592601589102387e-5,
    5.592673578504937e-5,
    5.5927024261000484e-5,
    5.5927139859494356e-5,
    5.5927186182357836e-5,
    5.5927204744962e-5,
    5.592721218341341e-5,
    5.592721516416791e-5,
    5.5927216358623226e-5,
    5.5927216837268324e-5,
    5.592721702907218e-5,
    5.5927217105932294e-5,
    5.592721713673187e-5,
    5.592721714907395e-5,
    5.59272171540197e-5,
    5.592721715600158e-5,
    5.592721715679576e-5,
    5.592721715711401e-5,
    5.592721715724153e-5,
    5.592721715729264e-5,
    5.5927217157313116e-5,
    5.592721715732132e-5,
    5.592721715732461e-5,
    5.592721715732593e-5,
    5.592721715732646e-5,
    5.592721715732667e-5,
    5.592721715732675e-5,
    5.5927217157326784e-5,
    5.5927217157326804e-5,
    5.5927217157326804e-5,
    5.592721715732681e-5,
    5.592721715732681e-5,
    5.592721715732681e-5,
    5.592721715732681e-5,
    5.592789264161808e-5,
    5.605425912457543e-5,
    5.8813598829479934e-5,
    7.91170009791165e-5,
    28582.766642113842,
    18844.018290863503,
    17202.885046941272,
    16885.53445421966,
    5482.792583678626,
    3960.011637760267,
    3734.881880838226,
    3711.624860530096,
    264.04493689983724,
    195.66420986293622,
    186.27159709541667,
    185.77122142300996,
    1.414642190340981,
    1.05160960653618,
    1.0022715588886042,
    1.0000120779170787,
};
